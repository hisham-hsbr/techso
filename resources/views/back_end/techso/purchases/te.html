<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Invoice</title>
        <link
            rel="stylesheet"
            href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
        />
        <link
            href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css"
            rel="stylesheet"
        />
    </head>
    <body>
        <div class="container mt-5">
            <h2 class="mb-4">Invoice</h2>
            <table class="table table-bordered" id="invoiceTable">
                <thead>
                    <tr>
                        <th>Serial No</th>
                        <th>Item</th>
                        <th>Quantity</th>
                        <th>Price</th>
                        <th>Total</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Rows will be added here -->
                </tbody>
            </table>
            <button class="btn btn-primary mb-3" id="addRow">Add Item</button>
            <div class="row">
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="subTotal">Subtotal:</label>
                        <input
                            type="text"
                            class="form-control"
                            id="subTotal"
                            readonly
                        />
                    </div>
                    <div class="form-group">
                        <label for="tax">Tax (%):</label>
                        <input type="text" class="form-control" id="tax" />
                    </div>
                    <div class="form-group">
                        <label for="discount">Discount (%):</label>
                        <input type="text" class="form-control" id="discount" />
                    </div>
                    <div class="form-group">
                        <label for="total">Total:</label>
                        <input
                            type="text"
                            class="form-control"
                            id="total"
                            readonly
                        />
                    </div>
                </div>
            </div>
        </div>

        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
        <script src="invoice.js"></script>
        <script>
            $(document).ready(function () {
                let rowCount = 0;

                // Initialize Select2
                function initializeSelect2() {
                    $(".item-select").select2({
                        placeholder: "Select an item",
                        width: "100%",
                        data: [
                            { id: 1, text: "Item 1" },
                            { id: 2, text: "Item 2" },
                            { id: 3, text: "Item 3" },
                        ],
                    });
                }

                // Add new row
                $("#addRow").on("click", function () {
                    rowCount++;
                    const rowHtml = `
            <tr>
                <td class="serial">${rowCount}</td>
                <td><select class="form-control item-select"></select></td>
                <td><input type="number" class="form-control quantity" value="1"></td>
                <td><input type="number" class="form-control price" value="0"></td>
                <td class="total">0</td>
                <td><button class="btn btn-danger remove-row">Remove</button></td>
            </tr>`;
                    $("#invoiceTable tbody").append(rowHtml);
                    initializeSelect2();
                    updateSubtotal();
                });

                // Remove row
                $(document).on("click", ".remove-row", function () {
                    $(this).closest("tr").remove();
                    updateSerialNumbers();
                    updateSubtotal();
                });

                // Update serial numbers
                function updateSerialNumbers() {
                    rowCount = 0;
                    $("#invoiceTable tbody tr").each(function () {
                        rowCount++;
                        $(this).find(".serial").text(rowCount);
                    });
                }

                // Calculate totals
                $(document).on("input", ".quantity, .price", function () {
                    const row = $(this).closest("tr");
                    const quantity =
                        parseFloat(row.find(".quantity").val()) || 0;
                    const price = parseFloat(row.find(".price").val()) || 0;
                    const total = quantity * price;
                    row.find(".total").text(total.toFixed(2));
                    updateSubtotal();
                });

                function updateSubtotal() {
                    let subtotal = 0;
                    $("#invoiceTable tbody .total").each(function () {
                        subtotal += parseFloat($(this).text()) || 0;
                    });
                    $("#subTotal").val(subtotal.toFixed(2));
                    updateTotal();
                }

                function updateTotal() {
                    const subtotal = parseFloat($("#subTotal").val()) || 0;
                    const tax = parseFloat($("#tax").val()) || 0;
                    const discount = parseFloat($("#discount").val()) || 0;

                    const total =
                        subtotal +
                        subtotal * (tax / 100) -
                        subtotal * (discount / 100);
                    $("#total").val(total.toFixed(2));
                }

                $("#tax, #discount").on("input", function () {
                    updateTotal();
                });
            });
        </script>
    </body>
</html>
